# 2023-01-14
## `MPI_Scatterv`, `MPI_Gattherv` and `MPI_Allgatherv`
The common thread between these three (and perhaps more) collective
communication functions are the two buffers `sendcounts` and `displs` (see `man 3 MPI_Gatherv` or [view online](https://www.open-mpi.org/doc/v3.1/man3/MPI_Gatherv.3.php)).

I found myself writing code to construct these two buffers every
time for roughly equal distribution. Here is the convenience function.

```C
typedef struct
{
    int *sendcounts;
    int *displs;
} vparams_t;

int vparams_create(vparams_t *vp, int count, int nprocs)
{
    int *sendcounts = malloc(sizeof(int) * nprocs);
    check_mem(sendcounts);
    int *displs = malloc(sizeof(int) * nprocs);
    check_mem(displs);
    int quot = count / nprocs;
    int rem = count % nprocs;
    int running_displ = 0;
    for (int i = 0; i < nprocs; i++)
    {
        int sc = quot;
        if (i < rem)
            sc++;
        sendcounts[i] = sc;
        displs[i] = running_displ;
        running_displ += sc;
    }

    vp->sendcounts = sendcounts;
    vp->displs = displs;
    return 0;
error:
    return 1;
}
```

## Presentation on Error Handling in C
Came across these nice [slides](https://resources.sei.cmu.edu/asset_files/Presentation/2016_017_101_484207.pdf).
