# 2023-01-14
## `MPI_Scatterv`, `MPI_Gattherv` and `MPI_Allgatherv`
The common thread between these three (and perhaps more) collective
communication functions are the two buffers `sendcounts` and `displs` (see `man 3 MPI_Gatherv` or [view online](https://www.open-mpi.org/doc/v3.1/man3/MPI_Gatherv.3.php)).

I found myself writing code to construct these two buffers every
time for roughly equal distribution. Here is the convenience function.

```C
typedef struct
{
    int *sendcounts;
    int *displs;
} vparams_t;

int vparams_create(vparams_t *vp, int count, int nprocs)
{
    int *sendcounts = malloc(sizeof(int) * nprocs);
    check_mem(sendcounts);
    int *displs = malloc(sizeof(int) * nprocs);
    check_mem(displs);
    int quot = count / nprocs;
    int rem = count % nprocs;
    int running_displ = 0;
    for (int i = 0; i < nprocs; i++)
    {
        int sc = quot;
        if (i < rem)
            sc++;
        sendcounts[i] = sc;
        displs[i] = running_displ;
        running_displ += sc;
    }

    vp->sendcounts = sendcounts;
    vp->displs = displs;
    return 0;
error:
    return 1;
}
```

## Presentation on Error Handling in C
Came across these nice [slides](https://resources.sei.cmu.edu/asset_files/Presentation/2016_017_101_484207.pdf).

# 2023-01-15
## MPI - Basics of Creating Communicators and Process Topologies 
As it turns out, you do not always have to fiddle around with index calculations to calculate the ranks of
your neighbouring process(es). `MPI_Cart_create` and friends can handle some of that for you.

Here is a minimum working example (MWE) for creating a 1D torus.
```C
#include <stdio.h>
#include <stdlib.h>
#include <mpi.h>
#include <stdbool.h>

int main(int argc, char *argv[])
{
    int rank, nprocs;
    MPI_Comm commring;
    MPI_Init(&argc, &argv);
    MPI_Comm_size(MPI_COMM_WORLD, &nprocs);
    MPI_Comm_rank(MPI_COMM_WORLD, &rank);

    int const period = 1, ndims = nprocs;
    bool reorder = true;
    MPI_Cart_create(MPI_COMM_WORLD, 1, &ndims, &period, reorder, &commring);
    int left, right;
    MPI_Cart_shift(commring, 0, 1, &left, &right);

    fprintf(stderr, "rank %d: left neighbour: %d, right neighbour: %d\n", rank, left, right);
    MPI_Finalize();
    return 0;
}
```
Please don't enable too many warning flags because we're ignoring a lot of return values. Higher dimensions are possible, but am yet
to try it. Consider consulting the [man pages](https://www.open-mpi.org/doc/v4.1/man3/MPI_Cart_create.3.php) `man 3 MPI_Cart_create`.
